- name: Create directory for log files
  file:
    path: /var/traveloka/log/
    state: directory

- name: Create log files for CloudWatch to pick-up
  file:
    path: "/var/traveloka/log/{{ app_name }}_out.log"
    state: touch

- name: Create log files for CloudWatch to pick-up
  file:
    path: "/var/traveloka/log/{{ app_name }}_error.log"
    state: touch

- name: Insert API key to datadog.conf
  shell: |
    sed -i -e "s@api_key:.*@api_key: $(aws ssm get-parameters --name /tvlk-secret/shared/bei/datadog.api.key --with-decryption --query Parameters[0].Value --output text --region ap-southeast-1)@" /etc/dd-agent/datadog.conf

- name: Restart Datadog agent
  systemd:
    state: restarted
    name: datadog-agent